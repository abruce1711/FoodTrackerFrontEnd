@using foodTrackerFrontEnd.Interfaces;
@using foodTrackerFrontEnd.Models;
@inject IFoodTrackerApiService<FoodStorage> _storageService;

<MudNavMenu>
    <AuthorizeView>
        <Authorized>
            <MudNavLink Href="/" Match="NavLinkMatch.All">Home</MudNavLink>
            <MudNavGroup Title="Storage" Expanded="false">
                @if (storageLoading)
                {
                    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
                }
                else
                {
                    @foreach (var storage in storage)
                    {
                        <MudNavLink href="@($"storage/{storage.Name.ToLower()}")" >@storage.Name</MudNavLink>
                    }
                }
            </MudNavGroup>
            <MudNavLink Href="#" Match="NavLinkMatch.Prefix">Account</MudNavLink>
            <MudNavLink Href="/logout" Match="NavLinkMatch.Prefix">Logout</MudNavLink>
        </Authorized>
        <NotAuthorized>
            <MudNavLink Href="@AuthStateProvider.LoginUrl()" Match="NavLinkMatch.Prefix">Login</MudNavLink>
        </NotAuthorized>
    </AuthorizeView>
</MudNavMenu>

@code{
    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }
    private IEnumerable<FoodStorage> storage;
    private bool storageLoading = true;

    protected override async Task OnInitializedAsync()
    {
        var authState = await authenticationStateTask;
        var user = authState.User;

        if (user.Identity.IsAuthenticated)
        {
            storage = new List<FoodStorage>();
            storage = await _storageService.List();
        }

        storageLoading = false;
    }
}